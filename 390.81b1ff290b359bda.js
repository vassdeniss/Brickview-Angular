"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[390],{9390:(se,f,l)=>{l.r(f),l.d(f,{ReviewModule:()=>ae});var d=l(6814),y=l(6208),c=l(6223),p=l(649),M=l(4202),g=l(8915),e=l(5879),v=l(8998),_=l(8394),b=l(3076),u=l(3911),w=l(2864),O=l(7852);const I=["youTubePlayer"];let A=(()=>{class i{constructor(t){this.changeDetectorRef=t}ngAfterViewInit(){this.onResize(),window.addEventListener("resize",this.onResize.bind(this))}onResize(){this.videoWidth=Math.min(this.player.nativeElement.clientWidth,1200),this.videoHeight=.6*this.videoWidth,this.changeDetectorRef.detectChanges()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(e.sBO))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-player"]],viewQuery:function(t,n){if(1&t&&e.Gf(I,5),2&t){let r;e.iGM(r=e.CRH())&&(n.player=r.first)}},inputs:{videoId:"videoId"},decls:3,vars:3,consts:[["youTubePlayer",""],[3,"width","height","videoId"]],template:function(t,n){1&t&&(e.TgZ(0,"div",null,0),e._UZ(2,"youtube-player",1),e.qZA()),2&t&&(e.xp6(2),e.Q6J("width",n.videoWidth)("height",n.videoHeight)("videoId",n.videoId))},dependencies:[O.D]}),i})();function P(i,o){if(1&i&&(e.TgZ(0,"p"),e._uU(1),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.Oqu(t.customPopupContent)}}function T(i,o){if(1&i&&e._UZ(0,"img",15),2&i){const t=e.oxw(2);e.Q6J("src",t.enlargeImageSource,e.LSH)}}function R(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"app-popup",12),e.NdJ("closed",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.popup.hide())}),e.YNc(1,P,2,1,"p",13),e.YNc(2,T,1,1,"img",14),e.qZA()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.customPopupContent),e.xp6(1),e.Q6J("ngIf",!t.customPopupContent)}}const F=function(i){return["/reviews",i,"edit"]};function U(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"div",16)(1,"button",17),e._UZ(2,"i",18),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"button",19),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.deleteReview())}),e._UZ(6,"i",20),e._uU(7),e.ALo(8,"translate"),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("routerLink",e.VKq(7,F,null==t.review?null:t.review._id)),e.xp6(2),e.hij(" ",e.lcZ(4,3,"review.detail-review.edit")," "),e.xp6(4),e.hij(" ",e.lcZ(8,5,"review.detail-review.delete")," ")}}function J(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"img",23),e.NdJ("click",function(){const s=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.enlargeImage(s))}),e.qZA()}2&i&&e.Q6J("src",o.$implicit,e.LSH)}function q(i,o){if(1&i&&(e.TgZ(0,"div",21),e.YNc(1,J,1,1,"img",22),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",null==t.review?null:t.review.setImages)}}function k(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"div",24),e._UZ(1,"app-player",25),e.TgZ(2,"ul")(3,"li",26),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.previousVideo())}),e._uU(4,"Previous"),e.qZA(),e.TgZ(5,"li",26),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.nextVideo())}),e._uU(6,"Next"),e.qZA()()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("videoId",t.activeVideo)}}function L(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"div",30)(1,"img",31),e.NdJ("click",function(){const s=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.enlargeImage(s.image))}),e.qZA(),e.TgZ(2,"h4"),e._uU(3),e.qZA(),e.TgZ(4,"p"),e._uU(5),e.ALo(6,"translate"),e.qZA()()}if(2&i){const t=o.$implicit;e.xp6(1),e.Q6J("src",t.image,e.LSH),e.xp6(2),e.Oqu(t.name),e.xp6(2),e.AsE("",e.lcZ(6,4,"review.detail-review.qty"),": ",t.quantity,"")}}function E(i,o){if(1&i&&(e.TgZ(0,"div",27)(1,"h2"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"div",28),e.YNc(5,L,7,6,"div",29),e.qZA()()),2&i){const t=e.oxw();e.xp6(2),e.Oqu(e.lcZ(3,2,"review.detail-review.minifigures")),e.xp6(3),e.Q6J("ngForOf",null==t.review?null:t.review.setMinifigures)}}let x=!1,N=(()=>{class i{constructor(t,n,r,s,a,m){this.reviewService=t,this.route=n,this.routeNavigate=r,this.popup=s,this.userService=a,this.translate=m,this.review=void 0,this.isImageEnlarged=!1,this.enlargeImageSource="",this.isOwner=!1,this.customPopupContent=void 0,this.playlist=[],this.currentIndex=0}ngOnInit(){if(!x){const t=document.createElement("script");t.src="https://www.youtube.com/iframe_api",document.body.appendChild(t),x=!0}this.route.data.subscribe(({review:t})=>{this.review=t,this.playlist=this.review.setVideoIds,this.activeVideo=this.playlist[this.currentIndex]}),this.editor=new g.ML,this.isOwner=this.userService.user?._id===this.review?.userId}ngOnDestroy(){this.editor.destroy()}previousVideo(){this.currentIndex--,this.currentIndex<0&&(this.currentIndex=0),this.activeVideo=this.playlist[this.currentIndex]}nextVideo(){this.currentIndex++,this.currentIndex===this.playlist.length&&this.currentIndex--,this.activeVideo=this.playlist[this.currentIndex]}enlargeImage(t){this.popup.show(),this.enlargeImageSource=t||""}deleteReview(){let t;this.translate.get("review.detail-review.alert").subscribe(n=>t=n),confirm(t)&&this.reviewService.deleteReview(this.review?._id).subscribe({next:()=>{this.routeNavigate.navigate(["sets/my-sets"])},error:n=>{this.customPopupContent=n.error.message,this.popup.show()}})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(v.F),e.Y36(p.gz),e.Y36(p.F0),e.Y36(_.q),e.Y36(b.K),e.Y36(u.sK))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-detail-review"]],decls:40,vars:35,consts:[["class","enlarged-image-container","title","",3,"closed",4,"ngIf"],[1,"user-container"],["class","buttons",4,"ngIf"],[1,"container"],[1,"set-image"],["width","100%",3,"src","alt","click"],[1,"set-info"],[1,"review-section"],[3,"editor","ngModel","disabled","ngModelChange"],["class","set-images",4,"ngIf"],["class","set-videos",4,"ngIf"],["class","minifigures",4,"ngIf"],["title","",1,"enlarged-image-container",3,"closed"],[4,"ngIf"],["class","enlarged-image","alt","Enlarged Image",3,"src",4,"ngIf"],["alt","Enlarged Image",1,"enlarged-image",3,"src"],[1,"buttons"],[1,"button-warning",3,"routerLink"],[1,"fa-solid","fa-pen-to-square"],[1,"button-danger",3,"click"],[1,"fa-solid","fa-trash"],[1,"set-images"],[3,"src","click",4,"ngFor","ngForOf"],[3,"src","click"],[1,"set-videos"],[3,"videoId"],[1,"playlist-item",3,"click"],[1,"minifigures"],[1,"minifigure-container"],["class","minifigure",4,"ngFor","ngForOf"],[1,"minifigure"],["alt","fig.name",3,"src","click"]],template:function(t,n){1&t&&(e.YNc(0,R,3,2,"app-popup",0),e.TgZ(1,"div",1)(2,"h2"),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.YNc(5,U,9,9,"div",2),e.qZA(),e.TgZ(6,"div",3)(7,"div",4)(8,"img",5),e.NdJ("click",function(){return n.enlargeImage(null==n.review?null:n.review.setImage)}),e.qZA()(),e.TgZ(9,"div",6)(10,"h1"),e._uU(11),e.qZA(),e.TgZ(12,"p")(13,"strong"),e._uU(14),e.ALo(15,"translate"),e.qZA(),e._uU(16),e.qZA(),e.TgZ(17,"p")(18,"strong"),e._uU(19),e.ALo(20,"translate"),e.qZA(),e._uU(21),e.qZA(),e.TgZ(22,"p")(23,"strong"),e._uU(24),e.ALo(25,"translate"),e.qZA(),e._uU(26),e.qZA(),e.TgZ(27,"p")(28,"strong"),e._uU(29),e.ALo(30,"translate"),e.qZA(),e._uU(31),e.qZA()()(),e.TgZ(32,"div",7)(33,"h2"),e._uU(34),e.ALo(35,"translate"),e.qZA(),e.TgZ(36,"ngx-editor",8),e.NdJ("ngModelChange",function(s){return n.review.content=s}),e.qZA()(),e.YNc(37,q,2,1,"div",9),e.YNc(38,k,7,1,"div",10),e.YNc(39,E,6,4,"div",11)),2&t&&(e.Q6J("ngIf",n.popup.isActive),e.xp6(3),e.lnq(" ",null==n.review?null:n.review.setName," ",e.lcZ(4,23,"review.detail-review.from"),": ",null==n.review?null:n.review.userUsername," "),e.xp6(2),e.Q6J("ngIf",n.isOwner),e.xp6(3),e.Q6J("src",null==n.review?null:n.review.setImage,e.LSH)("alt",null==n.review?null:n.review.setName),e.xp6(3),e.Oqu(null==n.review?null:n.review.setName),e.xp6(3),e.hij("",e.lcZ(15,25,"review.detail-review.number"),":"),e.xp6(2),e.hij(" ",null==n.review?null:n.review.setNumber," "),e.xp6(3),e.hij("",e.lcZ(20,27,"general.review.parts"),":"),e.xp6(2),e.hij(" ",null==n.review?null:n.review.setParts," "),e.xp6(3),e.hij("",e.lcZ(25,29,"general.review.year"),":"),e.xp6(2),e.hij(" ",null==n.review?null:n.review.setYear," "),e.xp6(3),e.hij("",e.lcZ(30,31,"review.detail-review.minifigures"),":"),e.xp6(2),e.hij(" ",null==n.review?null:n.review.setMinifigCount," "),e.xp6(3),e.Oqu(e.lcZ(35,33,"review.detail-review.review")),e.xp6(2),e.Q6J("editor",n.editor)("ngModel",n.review.content)("disabled",!0),e.xp6(1),e.Q6J("ngIf",n.review.setImages.length>0),e.xp6(1),e.Q6J("ngIf",n.playlist.length>0),e.xp6(1),e.Q6J("ngIf",n.review.setMinifigures.length>0))},dependencies:[d.sg,d.O5,p.rH,w.R,c.JJ,g.tP,c.On,A,u.X$],styles:[".container[_ngcontent-%COMP%]{display:flex;background-color:var(--primary-color);justify-content:center;margin-bottom:20px}.set-info[_ngcontent-%COMP%]{flex:1;max-width:400px;color:#fff;padding-right:20px}.set-image[_ngcontent-%COMP%]{flex:1;max-width:300px;margin:30px 50px 30px 30px}.review-section[_ngcontent-%COMP%], .minifigures[_ngcontent-%COMP%]{padding:10px;background-color:#fff;margin-bottom:20px}.minifigures[_ngcontent-%COMP%]{background-color:var(--secondary-color)}.minifigure[_ngcontent-%COMP%]{display:flex;align-items:center;gap:40px}.minifigure-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:20px}.minifigure[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border:1px solid black;width:10%}.user-container[_ngcontent-%COMP%]{margin:50px auto 20px;background-color:var(--secondary-color);padding:20px;border-radius:5px;display:flex;flex-direction:column;align-items:center;justify-content:center}.set-images[_ngcontent-%COMP%]{background-color:var(--primary-color);margin-bottom:20px;display:flex;flex-wrap:wrap;gap:18px;padding:18px}.set-images[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{flex:1 0 auto;max-width:15%;height:auto}img[_ngcontent-%COMP%]{cursor:pointer}.enlarged-image-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.enlarged-image[_ngcontent-%COMP%]{max-width:80%}.buttons[_ngcontent-%COMP%]{display:flex;gap:10px}.button-danger[_ngcontent-%COMP%], .button-warning[_ngcontent-%COMP%]{color:#fff;border:none;outline:none;border-radius:5px;padding:8px 16px;font-size:14px;margin-top:10px;cursor:pointer;box-shadow:5px 5px 5px #000;transition:all .3s ease}.button-danger[_ngcontent-%COMP%]{background-color:#bd1405;box-shadow:5px 5px 5px #000;transition:all .3s ease}.button-warning[_ngcontent-%COMP%]{background-color:#ff0;color:#000}.button-danger[_ngcontent-%COMP%]:hover{background-color:#9e2203}.button-warning[_ngcontent-%COMP%]:hover{background-color:#d7e300}.playlist-item[_ngcontent-%COMP%]{padding:10px;list-style:none;background-color:var(--secondary-color);cursor:pointer;text-align:center;margin-bottom:5px}ul[_ngcontent-%COMP%]{padding:0;margin:0 auto}.set-videos[_ngcontent-%COMP%]{width:50%;background-color:var(--secondary-color);margin:0 auto}@media only screen and (max-width: 600px){.set-info[_ngcontent-%COMP%], .set-image[_ngcontent-%COMP%]{max-width:100%}.container[_ngcontent-%COMP%]{flex-direction:column;justify-content:center;align-items:center}.set-info[_ngcontent-%COMP%]{padding:unset;text-align:center}.set-videos[_ngcontent-%COMP%]{margin:unset;width:100%}}@media only screen and (max-width: 1100px){.set-videos[_ngcontent-%COMP%]{margin:unset;width:100%}}"]}),i})();var S=l(7398),C=l(8495),h=l(1384);function V(i,o){if(1&i&&e._UZ(0,"img",1),2&i){const t=e.oxw(2);e.s9C("src",t.set.userImage,e.LSH)}}const Y=function(i){return["/sets",i]},D=function(i){return["/reviews",i]};function H(i,o){if(1&i&&(e.ynx(0),e._UZ(1,"img",1),e.TgZ(2,"div",2)(3,"div",3),e._uU(4),e.qZA(),e.TgZ(5,"div",4),e.YNc(6,V,1,1,"img",5),e.TgZ(7,"div",6)(8,"span"),e._uU(9),e.ALo(10,"translate"),e.TgZ(11,"strong",7),e._uU(12),e.qZA()(),e.TgZ(13,"span"),e._uU(14),e.qZA()()(),e.TgZ(15,"div",8)(16,"app-button",9),e._UZ(17,"i",10),e._uU(18),e.ALo(19,"translate"),e.qZA()()(),e.BQk()),2&i){const t=e.oxw();e.xp6(1),e.s9C("src",t.set.image,e.LSH),e.xp6(3),e.hij(" ",t.set.name," "),e.xp6(2),e.Q6J("ngIf",t.set.userImage),e.xp6(3),e.hij("",e.lcZ(10,9,"general.review.author")," "),e.xp6(2),e.Q6J("routerLink",e.VKq(13,Y,t.set.username)),e.xp6(1),e.Oqu(t.set.username),e.xp6(2),e.Oqu(t.set.reviewDate),e.xp6(2),e.Q6J("routerLink",e.VKq(15,D,t.set._id)),e.xp6(2),e.hij(" ",e.lcZ(19,11,"general.review.view")," ")}}let $=(()=>{class i{constructor(){this.set=void 0}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-card"]],inputs:{set:"set"},decls:1,vars:1,consts:[[4,"ngIf"],[3,"src"],[1,"card-content"],[1,"card-title"],[1,"card-details"],[3,"src",4,"ngIf"],[1,"card-details__info"],[1,"user-link",3,"routerLink"],[1,"card-actions"],[3,"routerLink"],[1,"fa-solid","fa-arrow-up-right-from-square"]],template:function(t,n){1&t&&e.YNc(0,H,20,17,"ng-container",0),2&t&&e.Q6J("ngIf",n.set)},dependencies:[d.O5,p.rH,h.r,u.X$],styles:["[_nghost-%COMP%]{background-color:#373737;border-radius:5px;box-shadow:0 2px 4px #0000001a;display:flex;flex-direction:column;overflow:hidden;max-width:300px;height:340px;flex:1}[_nghost-%COMP%]   img[_ngcontent-%COMP%]{width:auto;height:200px;object-fit:contain}.card-content[_ngcontent-%COMP%]{padding:10px;display:flex;flex-direction:column}.card-title[_ngcontent-%COMP%]{font-weight:700;align-self:center;margin-bottom:5px;color:var(--secondary-color)}.card-details[_ngcontent-%COMP%]{display:flex;gap:10px;margin-top:10px;align-items:center;justify-content:center;height:35px}.card-details[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:35px;height:35px;border-radius:50%;object-fit:cover}.card-details__info[_ngcontent-%COMP%]{display:flex;flex-direction:column;font-size:14px;justify-content:center;color:var(--secondary-color)}.card-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-around}.user-link[_ngcontent-%COMP%]{color:#fff;cursor:pointer;text-decoration:underline}@media (max-width: 600px){[_nghost-%COMP%]{max-width:100%;height:auto}}"]}),i})(),G=(()=>{class i{constructor(){this.searchEvent=new e.vpe}search(t){this.searchEvent.emit(t)}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-search"]],outputs:{searchEvent:"searchEvent"},decls:8,vars:6,consts:[[1,"search-form"],["type","text",3,"placeholder"],["searchField",""],["type","button",3,"click"],[1,"fa-solid","fa-magnifying-glass"]],template:function(t,n){if(1&t){const r=e.EpF();e.TgZ(0,"div",0),e._UZ(1,"input",1,2),e.ALo(3,"translate"),e.TgZ(4,"app-button",3),e.NdJ("click",function(){e.CHM(r);const a=e.MAs(2);return e.KtG(n.search(a.value))}),e._UZ(5,"i",4),e._uU(6),e.ALo(7,"translate"),e.qZA()()}2&t&&(e.xp6(1),e.s9C("placeholder",e.lcZ(3,2,"core.search.placeholder")),e.xp6(5),e.hij(" ",e.lcZ(7,4,"core.search.button")," "))},dependencies:[h.r,u.X$],styles:[".search-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-end}.search-form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:10px;border:1px solid #ccc;border-radius:4px}"]}),i})();function z(i,o){1&i&&e._UZ(0,"app-card",2),2&i&&e.Q6J("set",o.$implicit)}let K=(()=>{class i{constructor(t,n,r){this.activatedRoute=t,this.setService=n,this.router=r}ngOnInit(){this.sets$=this.activatedRoute.data.pipe((0,S.U)(t=>t.sets))}searchSets(t){t?(this.router.navigate([""],{queryParams:{setNumber:t}}),this.sets$=this.setService.getAll(t)):this.sets$=this.setService.getAll()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(p.gz),e.Y36(C.z),e.Y36(p.F0))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-all-reviews"]],decls:4,vars:3,consts:[[3,"searchEvent"],[3,"set",4,"ngFor","ngForOf"],[3,"set"]],template:function(t,n){1&t&&(e.TgZ(0,"app-search",0),e.NdJ("searchEvent",function(s){return n.searchSets(s)}),e.qZA(),e.TgZ(1,"ul"),e.YNc(2,z,1,1,"app-card",1),e.ALo(3,"async"),e.qZA()),2&t&&(e.xp6(2),e.Q6J("ngForOf",e.lcZ(3,1,n.sets$)))},dependencies:[d.sg,$,G,d.Ov],styles:["ul[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(4,270px);gap:20px;justify-content:center;align-items:center;padding:0}@media screen and (min-device-width: 668px) and (max-device-width: 1124px) and (orientation: portrait){ul[_ngcontent-%COMP%]{grid-template-columns:repeat(2,300px)}}@media screen and (min-device-width: 668px) and (max-device-width: 1124px) and (orientation: landscape){ul[_ngcontent-%COMP%]{grid-template-columns:repeat(3,300px)}}@media screen and (max-device-width: 480px) and (orientation: portrait){ul[_ngcontent-%COMP%]{grid-template-columns:1fr}}@media screen and (max-device-width: 640px) and (orientation: landscape){ul[_ngcontent-%COMP%]{grid-template-columns:1fr}}@media screen and (max-device-width: 640px){ul[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]}),i})();var B=l(9246);const W=["imageInput"];function ee(i,o){if(1&i&&(e.TgZ(0,"p"),e._uU(1),e.qZA()),2&i){const t=o.$implicit;e.xp6(1),e.Oqu(t)}}function te(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"app-popup",16),e.NdJ("closed",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.popup.hide())}),e.ALo(1,"translate"),e.YNc(2,ee,2,1,"p",17),e.qZA()}if(2&i){const t=e.oxw();e.s9C("title",e.lcZ(1,2,"general.error")),e.xp6(2),e.Q6J("ngForOf",t.errors)}}function ie(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"div",18),e._UZ(1,"img",19),e.TgZ(2,"a",20),e.NdJ("click",function(){const s=e.CHM(t).index,a=e.oxw();return e.KtG(a.deleteImage(s))}),e._uU(3,"\xd7"),e.qZA()()}if(2&i){const t=o.$implicit;e.xp6(1),e.Q6J("src",t,e.LSH)}}let Z=(()=>{class i{constructor(t,n,r,s,a){this.activated=t,this.route=n,this.fb=r,this.popup=s,this.review=a,this.mode="create",this.errors=[],this.images=[],this.reviewForm=this.fb.group({content:["",[c.kI.required,c.kI.minLength(50)]],setImages:[""],setVideoIds:["",[this.linkValidator]],_id:[""]}),this.toolbar=[["bold","italic"],["underline","strike"],["ordered_list","bullet_list"],[{heading:["h1","h2","h3","h4","h5","h6"]}],["text_color","background_color"],["align_left","align_center","align_right","align_justify"]]}ngOnInit(){this.activated.data.subscribe(({review:t})=>{t&&(this.mode="update",this.images=t.setImages,this.reviewForm.patchValue({content:t.content}),this.reviewForm.patchValue({setImages:t.setImages}),this.reviewForm.patchValue({setVideoIds:t.setVideoIds.map(n=>`https://www.youtube.com/watch?v=${n}`).join(", ")}))}),this.reviewForm.patchValue({_id:this.activated.snapshot.params.id}),this.editor=new g.ML}ngOnDestroy(){this.editor.destroy()}onSubmit(t){if(t.disabled=!0,this.reviewForm.invalid)return this.errors=[],(0,B.j)(this.reviewForm).forEach(a=>{this.errors.push(`${a.control} ${a.message}`)}),this.popup.show(),void(t.disabled=!1);const n={_id:this.reviewForm.value._id,content:this.reviewForm.value.content,setVideoIds:this.reviewForm.value.setVideoIds,setImages:this.images};("create"===this.mode?this.review.createReview(n):this.review.editReview(n)).subscribe({next:()=>{t.disabled=!1,this.route.navigate(["reviews",this.reviewForm.get("_id")?.value])},error:s=>{this.errors=[],this.errors.push(s.error.message),this.popup.show(),t.disabled=!1}})}onFileChange(t){const n=t.target;if(null===n.files)return;const r=n.files.length;for(let s=0;s<r;s++){const a=new FileReader;a.readAsDataURL(n.files[s]),a.onload=()=>{const m=a.result;this.images.push(m),this.insertImage(m)}}}deleteImage(t){const n=this.images[t];this.images.splice(t,1);const r=this.imageInput.nativeElement.files,s=new DataTransfer;for(let a=0;a<r.length;a++)a!==t&&s.items.add(r[a]);this.imageInput.nativeElement.files=s.files,this.removeImageFromEditor(n)}insertImage(t){this.editor.commands.insertHTML(`<img src="${t}" width="200"/>`).exec()}removeImageFromEditor(t){const r=(this.reviewForm.value.content||"").replace(new RegExp(`<img[^>]+src=["']${t.split(",")[0]}[^>]*>`,"g"),"");this.reviewForm.patchValue({content:r})}linkValidator(t){return""===t.value||t.errors&&!t.errors.invalidLinks||t.value.split(",").map(a=>a.trim()).every(a=>function s(a){return/^((?:https?:)?\/\/)?((?:www|m)\.)?((?:youtube(-nocookie)?\.com|youtu.be))(\/(?:[\w\-]+\?v=|embed\/|live\/|v\/)?)([\w\-]+)(\S+)?$/gm.test(a)}(a))?null:{invalidLinks:!0}}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(p.gz),e.Y36(p.F0),e.Y36(c.qu),e.Y36(_.q),e.Y36(v.F))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-create-edit-review"]],viewQuery:function(t,n){if(1&t&&e.Gf(W,5),2&t){let r;e.iGM(r=e.CRH())&&(n.imageInput=r.first)}},decls:29,vars:24,consts:[[3,"title","closed",4,"ngIf"],[1,"review-form",3,"formGroup","ngSubmit"],["id","toolbar",3,"editor","toolbar"],["id","content","name","content","formControlName","content",3,"editor","placeholder"],[1,"form-group"],["for","setImages"],[1,"fa-solid","fa-image","fa-xs"],["type","file","id","setImages","name","setImages","multiple","","accept","image/*","formControlName","setImages",3,"change"],["imageInput",""],["for","setVideoIds"],[1,"fa-brands","fa-youtube","fa-xs"],["type","text","id","setVideoIds","name","setVideoIds","formControlName","setVideoIds",3,"placeholder"],["class","image-wrapper",4,"ngFor","ngForOf"],["type","hidden","id","_id","name","_id","formControlName","_id"],["button",""],[1,"fa-solid","fa-computer-mouse"],[3,"title","closed"],[4,"ngFor","ngForOf"],[1,"image-wrapper"],[3,"src"],[1,"delete-button",3,"click"]],template:function(t,n){if(1&t){const r=e.EpF();e.YNc(0,te,3,4,"app-popup",0),e.TgZ(1,"form",1),e.NdJ("ngSubmit",function(){e.CHM(r);const a=e.MAs(25);return e.KtG(n.onSubmit(a))}),e.TgZ(2,"h2"),e._uU(3),e.ALo(4,"translate"),e.qZA(),e._UZ(5,"ngx-editor-menu",2)(6,"ngx-editor",3),e.ALo(7,"translate"),e.TgZ(8,"div",4)(9,"label",5),e._UZ(10,"i",6),e._uU(11),e.ALo(12,"translate"),e.qZA(),e.TgZ(13,"input",7,8),e.NdJ("change",function(a){return n.onFileChange(a)}),e.qZA()(),e.TgZ(15,"div",4)(16,"label",9),e._UZ(17,"i",10),e._uU(18),e.ALo(19,"translate"),e.qZA(),e._UZ(20,"input",11),e.ALo(21,"translate"),e.qZA(),e.YNc(22,ie,4,1,"div",12),e._UZ(23,"input",13),e.TgZ(24,"app-button",null,14),e._UZ(26,"i",15),e._uU(27),e.ALo(28,"translate"),e.qZA()()}2&t&&(e.Q6J("ngIf",n.popup.isActive),e.xp6(1),e.Q6J("formGroup",n.reviewForm),e.xp6(2),e.hij(" ",e.lcZ(4,12,"create"===n.mode?"review.create-review.header":"review.edit-review.header")," "),e.xp6(2),e.Q6J("editor",n.editor)("toolbar",n.toolbar),e.xp6(1),e.Q6J("editor",n.editor)("placeholder",e.lcZ(7,14,"create"===n.mode?"review.create-review.editor-placeholder":"review.edit-review.editor-placeholder")),e.xp6(5),e.hij(" ",e.lcZ(12,16,"create"===n.mode?"review.create-review.images":"review.edit-review.images"),""),e.xp6(7),e.hij(" ",e.lcZ(19,18,"create"===n.mode?"review.create-review.videos":"review.edit-review.videos"),""),e.xp6(2),e.Q6J("placeholder",e.lcZ(21,20,"create"===n.mode?"review.create-review.editor-placeholder":"review.edit-review.editor-placeholder")),e.xp6(2),e.Q6J("ngForOf",n.images),e.xp6(5),e.hij(" ",e.lcZ(28,22,"create"===n.mode?"review.create-review.button":"review.edit-review.button")," "))},dependencies:[d.sg,d.O5,w.R,h.r,c._Y,c.Fj,c.JJ,c.JL,c.sg,c.u,g.tP,g.Mn,u.X$],styles:["[_nghost-%COMP%]{margin:2rem}.review-form[_ngcontent-%COMP%]{max-width:700px;margin:0 auto;padding:20px;background-color:#373737;color:#fff;border-radius:4px}#toolbar[_ngcontent-%COMP%]{color:#000}.review-form[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:center;margin-bottom:20px}.form-group[_ngcontent-%COMP%]{margin-bottom:15px}label[_ngcontent-%COMP%]{display:block;font-weight:700;margin-bottom:12px}input[_ngcontent-%COMP%]{width:95%;padding:10px;border:1px solid #ccc;border-radius:4px}img[_ngcontent-%COMP%]{width:25%;height:auto;object-fit:cover}.image-wrapper[_ngcontent-%COMP%]{position:relative;display:inline}.delete-button[_ngcontent-%COMP%]{position:absolute;top:0;left:0;padding:4px 8px;background-color:red;color:#fff;border:none;border-radius:50%;cursor:pointer;z-index:1}.form-group[_ngcontent-%COMP%]{margin-top:10px}[_nghost-%COMP%]     .NgxEditor__Content{min-height:300px!important}"]}),i})();const ne=[{path:"",pathMatch:"full",component:K,title:"All Reviews",resolve:{sets:(i,o)=>(0,e.f3M)(C.z).getAll(i.queryParams.setNumber)}},{path:":id/create",component:Z,canActivate:[M._],title:"Create Review"},{path:":id",component:N,title:"Review",resolve:{review:(i,o)=>(0,e.f3M)(v.F).getReview(i.params.id)}},{path:":id/edit",component:Z,title:"Edit Review",resolve:{review:(i,o)=>(0,e.f3M)(v.F).getReview(i.params.id)}}];let oe=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[p.Bz.forChild(ne),p.Bz]}),i})();var re=l(8081);let ae=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[d.ez,oe,y.m,c.UX,g.FP,c.u5,re.I,u.aw,u.aw]}),i})()}}]);